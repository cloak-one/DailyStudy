## 实验目的

  1、了解传输层TCP/UDP协议构造；  2、了解网络层IP协议构造；  3、熟悉捕包软件的使用  

## 实验内容

  一、 对传输层协议TCP/UDP进行捕包分析  

1. 根据网址下载txt文件并且准备上传 
2. 使用Ethereal分组俘获上传的文件直至得到回答后停止捕获
3. 根据捕获到的报文信息回答问题  

二、 对网络层协议IP进行捕包分析

1. 下载并安装pingplotter利用其发送IP报文

2. 根据所输入的网址发送消息同时捕捉信息

3. 分别改变ICMP回复请求消息的大小为56，2000，3500字节，发送完成后结束捕捉 

注：新版的pingplotter无法设置#of  times to Trace字段  

## 实验结果

(1)  向gaia.cs.umass.edu服务器传送文件的客户端主机的IP地址和TCP端口号是多少？192.168.12.126 49976  ![img](https://s2.loli.net/2025/01/22/3uRWOCt1bm4A9kJ.png)  

(2)  Gaia.cs.umass.edu服务器的IP地址是多少？对这一连接，它用来发送和接收TCP报文段的端口号是多少？128.119.245.12 80  

![img](https://s2.loli.net/2025/01/22/un7YT3Bpwh9AQv5.png) 

(3)  客户服务器之间用于初始化TCP连接的TCP  SYN报文段的序号（sequence number）是多少？在该报文段中，是用什么来标示该报文段是SYN报文段的？为0，如图  

![img](https://s2.loli.net/2025/01/22/WNPoeDxImUZGavR.png)

(4)  服务器向客户端发送的SYNACK报文段序号是多少？该报文段中，ACKnowledgement字段的值是多少？Gaia.cs.umass.edu服务器是如何决定此值的？在该报文段中，是用什么来标示该报文段是SYNACK报文段的？

序号为0，ACKnowledgement字段的值为1，如图 

 ![img](https://s2.loli.net/2025/01/22/WJdYrzZjBhtko2w.png)  

(5)  包含HTTP POST命令的TCP报文段的序号是多少？152505  ![img](https://s2.loli.net/2025/01/22/SlHBFe1zNpjb23r.png)  

(6)  考虑在TCP连接中含有HTTP POST并把它作为第一个片段的TCP片段。在TCP连接（包括含有HTTP  POST的片段）中最先的六个片段的序列号是多少？每一个片段是什么时候发送的？每一个片段接收到ACK是什么时候？请给出每一个TCP片段发送和确认被收到时的间隔，即六个片段中的每一个RTT值是多少？*当接收到每一个ACK时的EstimatedRTT值是多少？假设对于第一个片段来说，EstimatedRTT值和标准的RTT值相同。  EstimatedRTT=(1-α)EstimatedRTT+αSampleRTT  （假设α＝0.125）*  

序列号、发送时间、接收时间如图。从图可得回答序列号774的RTT值为0.296154，之后仅回复了4854序列号的发送，表明采用累计应答的方式，同时也说明RTT的值相差不大。并且两者的ACK应答可视作同一时间则对应的EstimatedRTT = 0.296154  
![img](https://s2.loli.net/2025/01/22/ec5TuWRM63gv7XB.png)

![img](https://s2.loli.net/2025/01/22/knbglOhuWYI5jAr.jpg)    

(7)  前六个TCP报文段的长度各是多少？   1360  

(8)  在整个跟踪过程中，接收端公示的最小的可用缓存空间是多少？限制发送端的传输以后，接收端的缓存是否仍然不够用？241，不是	![img](https://s2.loli.net/2025/01/22/jDS8CwcqFh3oXeE.jpg)  

(9)  在跟踪文件中是否有重传的报文段？进行判断的依据是什么？  （答案不唯一）

没有，从TCP报文段的序列号中可以看出。从源端发往目的端的序号逐渐递增，如果这其中有重传的报文段，则其序号中应该有小于其临近的分组序号的分组，由于并没有看到这样的分组，所以没有被重传的分组。

(10)  选择你的电脑所发送的第一个ICMP请求消息，在包详细信息窗口扩展包的Internet协议部分。你的电脑的IP地址是多少？   

![img](https://s2.loli.net/2025/01/22/dPMpH4yTOSericb.jpg)

(11)  在IP包头部，上层协议区域的值是多少？ICMP(1)  

![img](https://s2.loli.net/2025/01/22/lQ5hq4kXpuN7YFO.jpg)

(12)  IP头部有多少字节？IP数据包的有效载荷是多少字节？解释你是怎样确定有效载荷的数量的？

20，36 = 56 - 20   

![img](https://s2.loli.net/2025/01/22/HeuDosvE82IpJKr.jpg)  

(13)  这个IP数据包被分割了吗？解释你是怎样确定这个数据包是否被分割？ 该数据包没有被分片。Flag字段为0，数据包的分片偏移量为0 

 ![img](https://s2.loli.net/2025/01/22/tnkeo3byLG1TR2d.jpg)  

(14)  接下来单击列名按IP源地址排序数据包，选择你的电脑发送的第一个ICMP请求消息，扩展显示IP协议的数据。  

![img](https://s2.loli.net/2025/01/22/fnd5Q1UHKRBbvrV.jpg)  

![img](https://s2.loli.net/2025/01/22/afn69uS3DV7cYhk.jpg)

(15)  在包捕获列表窗口，你能看到在第一个ICMP下的所有并发的ICMP消息吗？可以 

![img](https://s2.loli.net/2025/01/22/nMgfetQGbhBcDjv.jpg)   

(16)  往同一IP的数据包哪些字段在改变，而且必须改变？为什么？哪些字段是保持不变的，而且必须保持不变？  

必须改变的字段：   identification（标识符），用于区分每个数据包   header checksum（头部检查和），会随着首部数据的改变而改变  

必须保持不变的字段：   version（版本号）   header length（头部长度）   differentiated services field（区分服务）   protocol（协议）   source（源地址）   destination（目的地址） 

(17)  描述一下在IP数据包的Identification字段的值是什么样的？

![img](https://s2.loli.net/2025/01/22/n3N4lpPfKtY895Z.jpg)      

每一个Identification都是一个唯一的标识符，如0xeca8，且相邻数据包的Identification以步长为1递增。 

----

接下来找到通过最近的路由器发送到你的电脑去的ICMP的TTL溢出回复的系列，回答以下问题：

(18)  Identification字段和TTL字段的值是多少？0xebd8，255    

![img](https://s2.loli.net/2025/01/22/2SsLmDVdjT9JQCN.jpg)

(19)  所有的通过最近的路由器发送到你的电脑去的ICMP的TTL溢出回复是不是值都保持不变呢？为什么？	  

所有ICMP的TTL溢出回复中的Identification一直在变化， 其作为一个唯一的标识符。TTL字段保持不变，因为第一跳路由器的TTL始终相同。  

---

接下去研究一下分片，先按时间顺序排序数据包，找出在pingplotter中把包的大小改成2000后，你的电脑所发送的第一个ICMP请求消息。回答以下问题：  

(20)  那个消息是否传送多于一个IP数据包的分片？看第一个被分割的IP数据包的片段，在IP头部有什么信息指出数据包已经被分割？在IP头部有什么信息指出这是否是第一个与后面片段相对的片段？这个IP数据包的长度是多少？  ![img](https://s2.loli.net/2025/01/22/IhTf9ulc28Q64HO.jpg) 

 是的。Flags :0x1,  More fragments表示其已被分割；Fragment Offset: 0表明了这是第一个IP数据包；数据包长度为Data（1480  bytes）。  

(21)  看被分割的IP数据包的第二个片段。在IP头部有什么信息指出这不是第一个数据包片段？有更多的片段吗？你是怎么知道的？和上一个分片的长度加起来是2000吗？  

因为观察到fragment offset不为0，而是1480且Flags：0x0。同时如图所示第二个数据包分段从1480开始，表示其为第二个包，长度为520，且仅有这两个分段。和上一个分片的长度加起来是2020，但是减去多余的头部20则刚好为2000。

  ![img](https://s2.loli.net/2025/01/22/OurHt9MUZXT18VJ.jpg)  ![img](https://s2.loli.net/2025/01/22/z7RL3MoleFCEwgP.jpg)  

(22)  哪个字段在第一个和第二个片段之间的IP头部改变了？

Identification变了吗  Total Length、Header Checksum、Flags、Fragment 0ffset，Identification没有改变。 

(23)  再找出在pingplotter中把包的大小改成3500后，你的电脑所发送的第一个ICMP请求消息。回答以下问题：  ![img](https://s2.loli.net/2025/01/22/qFsemPdpwG9QcDf.jpg)  

(24)  从原始的数据包中产生了多少片段？片偏移分别为多少？如图  ![img](https://s2.loli.net/2025/01/22/rJKi6jf1ypEG3hY.jpg)  

(25)  在片段之中IP头部哪些字段改变了？Identification变了吗？  

在前两个与数据包和最后一个数据包中Total Length、Flags、Fragment 0ffset发生了变化，Identification始终没有改变。  